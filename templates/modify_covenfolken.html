<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    </head>
		<style>
				.input-wrapper div {
						margin-bottom: 10px;
				}
				.remove_input {
						margin-top: 10px;
						margin-left: 15px;
						vertical-align: text-bottom;
				}
				.add_covenfolk {
						margin-top: 1000px;
						margin-left: 10px;
						vertical-align: text-bottom;
				}
		</style>
    <body>
        <div class="main">
            Covenfolk<br>
            <form class="covenfolk_quick_add">
                Quick add 
                <input class="covenfolk_quick_add" id="covenfolk_quick_add_amount" name="covenfolk_quick_add_amount" type="number" placeholder=0 required>
                <select class="covenfolk_quick_add" id="covenfolk_quick_add_type" name="covenfolk_quick_add_type">
                    <option name="magi">Magi</option>
                    <option name="crafter">Crafters</option>
                    <option name="specialist">Specialists</option>
                    <option name="companion">Companions</option>
                    <option name="grog">Grogs</option>
                    <option name="noble">Nobles</option>
                    <option name="dependant">Dependants</option>
                    <option name="laborer">Laborers</option>
                    <option name="servant">Servants</option>
                    <option name="teamster">Teamsters</option>
                    <option name="horse">Large Animals</option>
                </select>
                <a href="javascript:void(0);" class="covenfolk_quick_add_button" title="Add random covenfolk"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
            </form>
            <form class="modify_covenant_covenfolken" action="{{url_for('modify_covenfolken')}}" method="POST">
                <hr>
                Mages:<a href="javascript:void(0);" class="add_magi add_covenfolk" title="Add magi"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_magi_wrapper">
                    {% for magi in session["current_covenant"].covenfolken.get_covenfolk_of_classification("magi") %}
                        <div>
                            <input class="magi_name covenfolk_input" value="{{magi.name}}" name="magi_name" type="text" required>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Crafters:<a href="javascript:void(0);" class="add_crafter add_covenfolk" title="Add crafter"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_crafter_wrapper">
                    {% for crafter in session["current_covenant"].covenfolken.get_covenfolk_of_classification("crafter") %}
                        <div>
                            <input class="crafter_name covenfolk_input" value="{{crafter.name}}" name="crafter_name" type="text" required>
                            <input class="covenfolk_input" value="{{crafter.profession}}" name="crafter_profession" type="text" required>
                            <select class="covenfolk_input" name="crafter_saving_category">
                                {% for saving_category in saving_categories %}
                                    {% if saving_category == crafter.saving_category %}
                                        <option value="{{saving_category}}" selected="selected">{{saving_category}}</option>
                                    {% else %}
                                        <option value="{{saving_category}}">{{saving_category}}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <input class="covenfolk_input" value={{crafter.skill}} name="crafter_skill" type="number" required>
                            <select class="covenfolk_input" name="crafter_rarity">
                                {% for rarity in ["Common", "Rare"] %}
                                    {% if rarity.lower() == crafter.rarity.lower() %}
                                        <option value={{rarity}} selected="selected">{{rarity}}</option>
                                    {% else %}
                                        <option value={{rarity}}>{{rarity}}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Specialists:<a href="javascript:void(0);" class="add_specialist add_covenfolk" title="Add specialist"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_specialist_wrapper">
                    {% for specialist in session["current_covenant"].covenfolken.get_covenfolk_of_classification("specialist") %}
                        <div>
                            <input class="specialist_name covenfolk_input" value="{{specialist.name}}" name="specialist_name" type="text" required>
                            <input class="covenfolk_input" value="{{specialist.profession}}" name="specialist_profession" type="text" required>
                            <select class="covenfolk_input" name="specialist_saving_category">
                                {% for saving_category in saving_categories %}
                                    {% if saving_category == specialist.saving_category %}
                                        <option value="{{saving_category}}" selected="selected">{{saving_category}}</option>
                                    {% else %}
                                        <option value="{{saving_category}}">{{saving_category}}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <input class="covenfolk_input" value={{specialist.skill}} name="specialist_skill" type="number" required>
                            <select class="covenfolk_input" name="specialist_rarity">
                                {% for rarity in ["Common", "Rare"] %}
                                    {% if rarity.lower() == specialist.rarity.lower() %}
                                        <option value={{rarity}} selected="selected">{{rarity}}</option>
                                    {% else %}
                                        <option value={{rarity}}>{{rarity}}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Companions:<a href="javascript:void(0);" class="add_companion add_covenfolk" title="Add companion"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_companion_wrapper">
                    {% for companion in session["current_covenant"].covenfolken.get_covenfolk_of_classification("companion") %}
                        <div>
                            <input class="companion_name covenfolk_input" value="{{companion.name}}" name="companion_name" type="text" required>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Grogs:<a href="javascript:void(0);" class="add_grog add_covenfolk" title="Add grog"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_grog_wrapper">
                    {% for grog in session["current_covenant"].covenfolken.get_covenfolk_of_classification("grog") %}
                        <div>
                            <input class="grog_name covenfolk_input" value="{{grog.name}}" name="grog_name" type="text" required>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Nobles:<a href="javascript:void(0);" class="add_noble add_covenfolk" title="Add noble"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_noble_wrapper">
                    {% for noble in session["current_covenant"].covenfolken.get_covenfolk_of_classification("noble") %}
                        <div>
                            <input class="noble_name covenfolk_input" value="{{noble.name}}" name="noble_name" type="text" required>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Dependants:<a href="javascript:void(0);" class="add_dependant add_covenfolk" title="Add dependant"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_dependant_wrapper" id="covenfolken_dependant_wrapper">
                    {% for dependant in session["current_covenant"].covenfolken.get_covenfolk_of_classification("dependant") %}
                        <div>
                            <input class="dependant_name covenfolk_input" value="{{dependant.name}}" name="dependant_name" type="text" required>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Laborers:<a href="javascript:void(0);" class="add_laborer add_covenfolk" title="Add laborer"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_laborer_wrapper" id="covenfolken_laborer_wrapper">
                    {% for laborer in session["current_covenant"].covenfolken.get_covenfolk_of_classification("laborer") %}
                        <div>
                            <input class="laborer_name covenfolk_input" value="{{laborer.name}}" name="laborer_name" type="text" required>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Servants:<a href="javascript:void(0);" class="add_servant add_covenfolk" title="Add servant"><img width=20 height=20 src="/static/icon_plus.png"/></a>
                <a href="javascript:void(0);" class="set_servants_to_minimum" title="Set Servants to Minimum" id="covenfolk_set_servants_to_minimum"><button>Set servants to minumum</button></a>
                <br></p>
                <div class="covenfolken_servant_wrapper" id="covenfolken_servant_wrapper">
                    {% for servant in session["current_covenant"].covenfolken.get_covenfolk_of_classification("servant") %}
                        <div>
                            <input class="servant_name covenfolk_input" value="{{servant.name}}" name="servant_name" type="text" required>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Teamsters:<a href="javascript:void(0);" class="add_teamster add_covenfolk" title="Add teamster"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_teamster_wrapper" id="covenfolken_teamster_wrapper">
                    {% for teamster in session["current_covenant"].covenfolken.get_covenfolk_of_classification("teamster") %}
                        <div>
                            <input class="teamster_name covenfolk_input" value="{{teamster.name}}" name="teamster_name" type="text" required>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <hr>
                Large Livestock:<a href="javascript:void(0);" class="add_animal add_covenfolk" title="Add animals"><img width=20 height=20 src="/static/icon_plus.png"/></a><br></p>
                <div class="covenfolken_animal_wrapper">
                    {% for animal in session["current_covenant"].covenfolken.get_covenfolk_of_classification("horse") %}
                        <div>
                            <input class="animal_name covenfolk_input" value="{{animal.name}}" name="animal_name" type="text" required>
                            <a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
                        </div>
                    {% endfor %}
                </div><br>

                <button class="submit" type="submit">Proceed</button>
            </form>
        </div>
    <script>
        $(document).ready(function(){
            var max_input_fields = 100;
            var covenfolk_count = {
              "magi": document.getElementsByClassName("magi_name").length,
              "crafter": document.getElementsByClassName("crafter_name").length,
              "specialist": document.getElementsByClassName("specialist_name").length,
              "companion": document.getElementsByClassName("companion_name").length,
              "grog": document.getElementsByClassName("grog_name").length,
              "noble": document.getElementsByClassName("noble_name").length,
              "dependant": document.getElementsByClassName("dependant_name").length,
              "laborer": document.getElementsByName("laborer_name").length,
              "servant": document.getElementsByClassName("servant_name").length,
              "teamster": document.getElementsByClassName("teamster_name").length,
              "animal": document.getElementsByClassName("animal_name").length,
						};


            function add_new_covenfolk(classification, new_covenfolk_count = 1) {
              var add_covenfolk = `add_${classification}`;
              var add_covenfolk_wrapper = $(`.covenfolken_${classification}_wrapper`);
              console.log("CLASSIFICATION:", classification);
              console.log("NCC:", new_covenfolk_count);
              if (classification == "crafter") {
								var new_covenfolk = `
										<div>
												<input class="crafter_name covenfolk_input" placeholder="Name" name="crafter_name" type="text" required>
												<input class="covenfolk_input" placeholder="Profession" name="crafter_profession" type="text" required>
												<select class="covenfolk_input" name="crafter_saving_category">
														{% for saving_category in saving_categories %}
																<option value="{{saving_category}}">{{saving_category}}</option>
														{% endfor %}
												</select>
												<input class="covenfolk_input" placeholder="Skill Level" name="crafter_skill" type="number" required>
												<select name="crafter_rarity">
														<option value="common">Common</option>
														<option value="rare">Rare</option>
												</select>
												<a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
										</div>
								`;
              } else if (classification == "specialist") {
							  var new_covenfolk = `
								    <div>
									    	<input class="specialist_name covenfolk_input" placeholder="Name" name="specialist_name" type="text" required>
												<input class="covenfolk_input" placeholder="Profession" name="specialist_profession" type="text" required>
												<select class="covenfolk_input" name="specialist_saving_category">
														{% for saving_category in saving_categories %}
																<option value="{{saving_category}}">{{saving_category}}</option>
														{% endfor %}
												</select>
												<input class="covenfolk_input" placeholder="Skill Level" name="specialist_skill" type="number" required>
												<select name="specialist_rarity">
														<option value="common">Common</option>
														<option value="rare">Rare</option>
												</select>
												<a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a><br>
										</div>
								`;
              } else {
							  var new_covenfolk = `<div><input class="${classification}_name covenfolk_input" placeholder="Covenfolk Name" name="${classification}_name" type="text" required><a href="javascript:void(0);" class="remove_input" title="Remove input"><img width=20 height=20 src="/static/icon_minus.png"/></a></div>`;
              }

              while (new_covenfolk_count > 0) { 
                  new_covenfolk_count--;
									if(covenfolk_count[classification] < max_input_fields){
											covenfolk_count[classification]++; 
											$(add_covenfolk_wrapper).append(new_covenfolk); 
											name_field = [...document.querySelectorAll(`.${classification}_name`)].pop();
											name_field.value = `${classification} ${covenfolk_count[classification]}`;
									}
						  }
						}

            $('.remove_input').click(function(e){
								e.preventDefault();
                let wrapper_class_name = $(this).parent('div').parent('div').prop("className");
                let classification = wrapper_class_name.split("_")[1];

								$(this).parent('div').remove();
								covenfolk_count[classification]--;
						});

            var add_magi = $('.add_magi');
            $(add_magi).click(function(){
                add_new_covenfolk("magi");
            });

            var add_companion = $('.add_companion');
            $(add_companion).click(function(){
                add_new_covenfolk("companion");
            });

            var add_noble = $('.add_noble');
            $(add_noble).click(function(){
                add_new_covenfolk("noble");
            });

            var add_crafter = $('.add_crafter');
            $(add_crafter).click(function(){
                add_new_covenfolk("crafter");
            });

            var add_specialist = $('.add_specialist');
            $(add_specialist).click(function(){
                add_new_covenfolk("specialist");
            });

            var add_dependant = $('.add_dependant');
            $(add_dependant).click(function(){
                add_new_covenfolk("dependant");
            });

            var add_grog = $('.add_grog');
            $(add_grog).click(function(){
                add_new_covenfolk("grog");
            });

            var add_laborer = $('.add_laborer');
            $(add_laborer).click(function(){
                add_new_covenfolk("laborer");
            });

            var add_servant = $('.add_servant');
            $(add_servant).click(function(){
                add_new_covenfolk("servant");
            });

            var set_servants_to_minimum = $('.set_servants_to_minimum');
            $(set_servants_to_minimum).click(function(e) {
                e.preventDefault();
                mocked_minimum = 3;
							  if (covenfolk_count["servant"] == mocked_minimum) {
                    console.log("Already match!");
                    return "true";
                } else if (covenfolk_count["servant"] < mocked_minimum) {
                    console.log("COVENFOLK_COUNT:", covenfolk_count["servant"]);
							      servants_to_add = mocked_minimum - covenfolk_count["servant"];
                    console.log("SERVANT_TO_ADD:", servants_to_add);
							    	add_new_covenfolk("servant", servants_to_add);
                } else {
                    existing_servants = document.getElementById("covenfolken_servant_wrapper");
                    console.log("ES:", existing_servants.children[0])
                    while (existing_servants.firstElementChild) {
                        console.log("REMOVING INSTANCE")
                        existing_servants.firstChild.remove();
                        covenfolk_count["servant"] = 0;
                    }
                    add_new_covenfolk("servant", mocked_minimum);
								}
						});

            var add_teamster = $('.add_teamster');
            $(add_teamster).click(function(){
                add_new_covenfolk("teamster");
            });

            var add_animal = $('.add_animal');
            $(add_animal).click(function(){
                add_new_covenfolk("animal");
            });

            var quick_add = $('.covenfolk_quick_add_button');
            var quick_add_amount2 = $('.covenfolk_quick_add_amount');
            var quick_add_type2 = $('.covenfolk_quick_add_type');
            $(quick_add).click(function() {
                var quick_add_amount = document.getElementById('covenfolk_quick_add_amount').value;
                var quick_add_type = document.getElementById('covenfolk_quick_add_type').value;
                var total = 0;
                let name_elements = [];

                if (quick_add_type === "Magi") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["magi"]);
                    if (total <= max_input_fields) {
                        add_new_covenfolk("magi", Number(quick_add_amount));
                    }
                } else if (quick_add_type === "Nobles") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["noble"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["noble"] < total) {
                            $(covenfolken_noble_wrapper).append(new_noble); 
                            name_field = [...document.querySelectorAll(".noble_name")].pop();
                            name_field.value = `Noble ${covenfolk_count["noble"]}`;
                            covenfolk_count["noble"]++;
                        }
                    }
                } else if (quick_add_type === "Companions") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["companion"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["companion"] < total) {
                            $(covenfolken_companion_wrapper).append(new_companion); 
                            name_field = [...document.querySelectorAll(".companion_name")].pop();
                            name_field.value = `Companion ${covenfolk_count["companion"]}`;
                            covenfolk_count["companion"]++;
                        }
                    }
                } else if (quick_add_type === "Crafters") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["crafter"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["crafter"] < total) {
                            $(covenfolken_crafter_wrapper).append(new_crafter); 
                            name_field = [...document.querySelectorAll(".crafter_name")].pop();
                            name_field.value = `Crafter ${covenfolk_count["crafter"]}`;
                            covenfolk_count["crafter"]++;
                        }
                    }
                } else if (quick_add_type === "Specialists") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["specialist"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["specialist"] < total) {
                            $(covenfolken_specialist_wrapper).append(new_specialist); 
                            name_field = [...document.querySelectorAll(".specialist_name")].pop();
                            name_field.value = `Specialist ${covenfolk_count["specialist"]}`;
                            covenfolk_count["specialist"]++;
                        }
                    }
                } else if (quick_add_type === "Dependants") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["dependant"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["dependant"] < total) {
                            $(covenfolken_dependant_wrapper).append(new_dependant); 
                            name_field = [...document.querySelectorAll(".dependant_name")].pop();
                            name_field.value = `Dependant ${covenfolk_count["dependant"]}`;
                            covenfolk_count["dependant"]++;
                        }
                    }
                } else if (quick_add_type === "Grogs") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["grog"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["grog"] < total) {
                            $(covenfolken_grog_wrapper).append(new_grog); 
                            name_field = [...document.querySelectorAll(".grog_name")].pop();
                            name_field.value = `Grog ${covenfolk_count["grog"]}`;
                            covenfolk_count["grog"]++;
                        }
                    }
                } else if (quick_add_type === "Laborers") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["laborer"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["laborer"] < total) {
                            $(covenfolken_laborer_wrapper).append(new_laborer); 
                            name_field = [...document.querySelectorAll(".laborer_name")].pop();
                            name_field.value = `Laborer ${covenfolk_count["laborer"]}`;
                            covenfolk_count["laborer"]++;
                        }
                    }
                } else if (quick_add_type === "Servants") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["servant"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["servant"] < total) {
                            $(covenfolken_servant_wrapper).append(new_servant); 
                            name_field = [...document.querySelectorAll(".servant_name")].pop();
                            name_field.value = `Servant ${covenfolk_count["servant"]}`;
                            covenfolk_count["servant"]++;
                        }
                    }
                } else if (quick_add_type === "Teamsters") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["teamster"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["teamster"] < total) {
                            $(covenfolken_teamster_wrapper).append(new_teamster); 
                            name_field = [...document.querySelectorAll(".teamster_name")].pop();
                            name_field.value = `Teamster ${covenfolk_count["teamster"]}`;
                            covenfolk_count["teamster"]++;
                        }
                    }
                } else if (quick_add_type === "Large Animals") {
                    total = Number(quick_add_amount) + Number(covenfolk_count["animal"]);
                    if (total <= max_input_fields) {
                        while (covenfolk_count["animal"] < total) {
                            $(covenfolken_animal_wrapper).append(new_animal); 
                            name_field = [...document.querySelectorAll(".animal_name")].pop();
                            name_field.value = `Animal ${covenfolk_count["animal"]}`;
                            covenfolk_count["animal"]++;
                        }
                    }
                }
            });

        });
    </script>
    </body>
</html>
